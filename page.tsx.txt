"use client"

import { useState, useEffect } from "react"
import { Plus, Zap, TrendingUp } from 'lucide-react'
import { ApplianceCard } from "@/components/appliance-card"
import { ThemeSettings, type Theme } from "@/components/theme-settings"
import { Button } from "@/components/ui/button"

export interface Appliance {
  id: string
  name: string
  watts: number
  hoursPerDay: number
  color: string
}

export default function Home() {
  const [showSplash, setShowSplash] = useState(true)

  const [theme, setTheme] = useState<Theme>({
    name: "Electric Vibes",
    colors: {
      primary: "oklch(0.65 0.25 285)",
      secondary: "oklch(0.75 0.2 310)",
      accent: "oklch(0.8 0.22 145)",
      cyan: "oklch(0.8 0.17 210)",
      pink: "oklch(0.75 0.25 345)",
      lime: "oklch(0.8 0.2 130)",
      purple: "oklch(0.65 0.25 285)",
    },
  })

  useEffect(() => {
    const timer = setTimeout(() => {
      setShowSplash(false)
    }, 2000)
    return () => clearTimeout(timer)
  }, [])

  useEffect(() => {
    document.documentElement.style.setProperty("--primary", theme.colors.primary)
    document.documentElement.style.setProperty("--secondary", theme.colors.secondary)
    document.documentElement.style.setProperty("--accent", theme.colors.accent)
    document.documentElement.style.setProperty("--cyan", theme.colors.cyan)
    document.documentElement.style.setProperty("--hot-pink", theme.colors.pink)
    document.documentElement.style.setProperty("--lime", theme.colors.lime)
    document.documentElement.style.setProperty("--electric-purple", theme.colors.purple)
  }, [theme])

  const [appliances, setAppliances] = useState<Appliance[]>([
    {
      id: "1",
      name: "Refrigerator",
      watts: 150,
      hoursPerDay: 24,
      color: "cyan",
    },
    {
      id: "2",
      name: "Air Conditioner",
      watts: 1500,
      hoursPerDay: 8,
      color: "pink",
    },
  ])

  const addAppliance = () => {
    const colors = ["purple", "cyan", "pink", "lime"]
    const newId = (appliances.length + 1).toString()
    const newAppliance: Appliance = {
      id: newId,
      name: "New Appliance",
      watts: 100,
      hoursPerDay: 4,
      color: colors[Math.floor(Math.random() * colors.length)],
    }
    setAppliances([...appliances, newAppliance])
  }

  const updateAppliance = (id: string, updates: Partial<Appliance>) => {
    setAppliances(appliances.map((app) => (app.id === id ? { ...app, ...updates } : app)))
  }

  const deleteAppliance = (id: string) => {
    setAppliances(appliances.filter((app) => app.id !== id))
  }

  const totalKwhPerDay = appliances.reduce((sum, app) => sum + (app.watts * app.hoursPerDay) / 1000, 0)
  const totalKwhPerMonth = totalKwhPerDay * 30
  const estimatedCost = totalKwhPerMonth * 0.12 // $0.12 per kWh

  if (showSplash) {
    return (
      <div className="fixed inset-0 bg-gradient-to-br from-primary via-secondary to-accent flex items-center justify-center z-50">
        <div className="text-center animate-pulse">
          <div className="flex items-center justify-center gap-4 mb-6">
            <div className="p-6 bg-white/20 rounded-3xl border-4 border-white/40 backdrop-blur-sm">
              <Zap className="w-20 h-20 text-white" />
            </div>
          </div>
          <h1 className="text-5xl md:text-7xl font-bold text-white mb-4">Power Usage</h1>
          <p className="text-xl text-white/90">Loading your calculator...</p>
        </div>
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-background text-foreground p-4 md:p-8">
      <div className="max-w-6xl mx-auto">
        {/* Header */}
        <div className="text-center mb-12 relative">
          <div className="absolute inset-0 bg-gradient-to-r from-primary via-secondary to-accent opacity-20 blur-3xl" />
          <div className="relative">
            <div className="absolute top-0 right-0">
              <ThemeSettings currentTheme={theme} onThemeChange={setTheme} />
            </div>
            <div className="inline-flex items-center gap-3 mb-4">
              <div className="p-3 bg-primary/20 rounded-2xl border-2 border-primary">
                <Zap className="w-10 h-10 text-primary" />
              </div>
            </div>
            <h1 className="text-5xl md:text-6xl font-bold mb-4 text-balance">
              <span className="bg-gradient-to-r from-primary via-secondary to-accent bg-clip-text text-transparent">
                Power Usage
              </span>{" "}
              Calculator
            </h1>
            <p className="text-lg text-muted-foreground max-w-2xl mx-auto text-pretty">
              Track your appliances and estimate your electricity consumption with our vibrant, interactive calculator
            </p>
          </div>
        </div>

        {/* Stats Cards */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
          <div className="bg-card border-2 border-cyan rounded-2xl p-6 shadow-lg shadow-cyan/20">
            <div className="flex items-center gap-3 mb-2">
              <div className="p-2 bg-cyan/20 rounded-lg">
                <TrendingUp className="w-5 h-5 text-cyan" />
              </div>
              <h3 className="text-sm font-semibold text-muted-foreground">Daily Usage</h3>
            </div>
            <p className="text-3xl font-bold text-cyan">{totalKwhPerDay.toFixed(2)} kWh</p>
          </div>

          <div className="bg-card border-2 border-primary rounded-2xl p-6 shadow-lg shadow-primary/20">
            <div className="flex items-center gap-3 mb-2">
              <div className="p-2 bg-primary/20 rounded-lg">
                <TrendingUp className="w-5 h-5 text-primary" />
              </div>
              <h3 className="text-sm font-semibold text-muted-foreground">Monthly Usage</h3>
            </div>
            <p className="text-3xl font-bold text-primary">{totalKwhPerMonth.toFixed(2)} kWh</p>
          </div>

          <div className="bg-card border-2 border-accent rounded-2xl p-6 shadow-lg shadow-accent/20">
            <div className="flex items-center gap-3 mb-2">
              <div className="p-2 bg-accent/20 rounded-lg">
                <TrendingUp className="w-5 h-5 text-accent" />
              </div>
              <h3 className="text-sm font-semibold text-muted-foreground">Est. Monthly Cost</h3>
            </div>
            <p className="text-3xl font-bold text-accent">${estimatedCost.toFixed(2)}</p>
          </div>
        </div>

        {/* Appliances Grid */}
        <div className="mb-6">
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-2xl font-bold">Your Appliances</h2>
            <Button
              onClick={addAppliance}
              className="bg-primary hover:bg-primary/90 text-primary-foreground shadow-lg shadow-primary/30 transition-all hover:scale-105"
            >
              <Plus className="w-5 h-5 mr-2" />
              Add Appliance
            </Button>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {appliances.map((appliance) => (
              <ApplianceCard
                key={appliance.id}
                appliance={appliance}
                onUpdate={updateAppliance}
                onDelete={deleteAppliance}
              />
            ))}
          </div>

          {appliances.length === 0 && (
            <div className="text-center py-16 bg-card border-2 border-dashed border-border rounded-2xl">
              <Zap className="w-16 h-16 text-muted-foreground mx-auto mb-4 opacity-50" />
              <p className="text-lg text-muted-foreground mb-4">No appliances added yet</p>
              <Button
                onClick={addAppliance}
                variant="outline"
                className="border-primary text-primary hover:bg-primary/10 bg-transparent"
              >
                <Plus className="w-5 h-5 mr-2" />
                Add Your First Appliance
              </Button>
            </div>
          )}
        </div>
      </div>
    </div>
  )
}